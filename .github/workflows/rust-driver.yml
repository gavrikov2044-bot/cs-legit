name: Build Rust Kernel Driver

on:
  push:
    paths:
      - 'cheats/cs2-rust/driver/**'
      - '.github/workflows/rust-driver.yml'
  workflow_dispatch:

env:
  CARGO_TERM_COLOR: always

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Install Rust Nightly
      uses: dtolnay/rust-toolchain@nightly
      with:
        targets: x86_64-pc-windows-msvc
        components: rust-src

    - name: Note about WDK
      run: |
        Write-Host "============================================"
        Write-Host "KERNEL DRIVER BUILD"
        Write-Host "============================================"
        Write-Host ""
        Write-Host "Kernel driver requires Windows Driver Kit (WDK)"
        Write-Host "which cannot be easily installed in GitHub Actions."
        Write-Host ""
        Write-Host "To build the driver locally:"
        Write-Host "1. Install Visual Studio 2022"
        Write-Host "2. Install Windows SDK"
        Write-Host "3. Install Windows Driver Kit (WDK)"
        Write-Host "4. Run: cargo +nightly build --release"
        Write-Host ""
        Write-Host "Uploading source code as artifact..."
        Write-Host "============================================"
      shell: powershell

    - name: Upload Driver Source
      uses: actions/upload-artifact@v4
      with:
        name: externa-driver-source
        path: cheats/cs2-rust/driver/
        if-no-files-found: error
